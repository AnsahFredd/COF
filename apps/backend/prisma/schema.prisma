generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                     String          @id @default(auto()) @map("_id") @db.ObjectId
  firstName              String
  lastName               String
  email                  String          @unique
  password               String
  phone                  String?
  avatar                 String?
  role                   Role            @default(USER)
  isEmailVerified        Boolean         @default(false)
  emailVerificationToken String?
  passwordResetToken     String?
  passwordResetExpires   DateTime?
  refreshToken           String?
  bookings               Booking[]
  customerEvents         CustomerEvent[]
  notifications          Notification[]
  notificationPreferences NotificationPreferences?
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  
  @@map("users")
}

type NotificationPreferences {
  email    Boolean @default(true)
  push     Boolean @default(true)
  marketing Boolean @default(false)
}

model CustomerEvent {
  id                     String              @id @default(auto()) @map("_id") @db.ObjectId
  fullName               String
  email                  String
  phone                  String
  eventType              EventType
  eventDate              DateTime
  eventLocation          String
  message                String?
  budget                 String
  guestCount             Int?
  preferredContactMethod ContactMethod
  status                 CustomerEventStatus @default(NEW)
  user                   User?               @relation(fields: [userId], references: [id])
  userId                 String?             @db.ObjectId
  assignedTo             String?
  notes                  String?
  bookings               Booking[]
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt

  @@map("customer_events")
}

model Booking {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  user            User          @relation(fields: [userId], references: [id])
  userId          String        @db.ObjectId
  eventType       EventType
  eventDate       DateTime
  eventLocation   String
  budget          String?
  message         String?
  status          BookingStatus @default(PENDING)
  customerEvent   CustomerEvent? @relation(fields: [customerEventId], references: [id])
  customerEventId String?        @db.ObjectId
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("bookings")
}

model Notification {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  user User @relation(fields: [userId], references: [id])
  userId String @db.ObjectId
  title String
  message String
  isRead Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
  @@map("notifications")
}

enum Role {
  USER
  ADMIN
}

enum EventType {
  WEDDING
  CORPORATE
  BIRTHDAY
  DINNER
  CONFERENCE
  GRADUATION
  ANNIVERSARY
  OUTDOORING
  FUNERAL
  NAMING_CEREMONY
  OTHER
}

enum ContactMethod {
  EMAIL
  PHONE
  WHATSAPP
}

enum CustomerEventStatus {
  NEW
  CONTACTED
  QUOTED
  CONVERTED
  DECLINED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model Portfolio {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?
  imageUrl    String
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("portfolio")
}
